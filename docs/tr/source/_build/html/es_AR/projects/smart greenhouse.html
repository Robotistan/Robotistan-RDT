
<!DOCTYPE html>

<html lang="es-AR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Smart Greenhouse &#8212; documentación de PicoBricks - 5.3.0-dev</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Picobricks Education" href="../education/education.html" />
    <link rel="prev" title="Maze Solver Robot" href="maze%20solver%20robot.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../education/education.html" title="Picobricks Education"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="maze%20solver%20robot.html" title="Maze Solver Robot"
             accesskey="P">anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de PicoBricks - 5.3.0-dev</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="projects.html" accesskey="U">Projects</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Smart Greenhouse</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="smart-greenhouse">
<h1>Smart Greenhouse<a class="headerlink" href="#smart-greenhouse" title="Enlace permanente a este encabezado">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Enlace permanente a este encabezado">¶</a></h2>
<p>In this project, we will prepare a simple greenhouse with <code class="docutils literal notranslate"><span class="pre">IOT</span> <span class="pre">technology</span></code> and PicoBricks. We will use PicoBricks with the ESP8266 wifi module in this greenhouse. In this way, we will turn the greenhouse into an object that we can track over the Internet.</p>
</section>
<section id="project-details-and-algorithm">
<h2>Project Details and Algorithm<a class="headerlink" href="#project-details-and-algorithm" title="Enlace permanente a este encabezado">¶</a></h2>
<p>The rapid changes in climate due to the effect of global warming cause a decrease in productivity in agricultural activities. In the 1500s, Daniel Barbaro built the first known greenhouse in history. Greenhouses are suitable environments for growing plants that can provide controllable air, water, heat and light conditions. In greenhouses, heaters are used to balance the heat, electric water motors for irrigation, fans are used to regulate humidity and to provide pollination. With the development of technology, the producer can follow the status of the greenhouse with his phone from anywhere and can do the work that needs to be done. The general name of this technology is <code class="docutils literal notranslate"><span class="pre">Internet</span> <span class="pre">of</span> <span class="pre">Things</span></code> (IOT). Special sensors are used to measure temperature, humidity and oxygen content in greenhouses. In addition, special sensors measuring soil moisture are used to decide on irrigation. Electronically controlled drip irrigation systems are used to increase irrigation efficiency.</p>
<p>The greenhouse model you will prepare will include a soil moisture sensor, and a DHT11 temperature and humidity sensor hanging from the top. A submersible pump will be placed in the water tank outside the model, and the hose coming out of the end of the pump will go to the ground in the greenhouse. Picoboard will be placed in a suitable place outside the greenhouse model. When Picobricks starts, it starts to broadcast wifi thanks to the ESP8266 wifi module. When we enter the IP address of Esp8266 from the smart phone connected to the same network, we encounter the web page where we will control the Greenhouse. Here we can see the temperature and humidity values. If we wish, we can start the irrigation process by giving the irrigation command.</p>
</section>
<section id="wiring-diagram">
<h2>Wiring Diagram<a class="headerlink" href="#wiring-diagram" title="Enlace permanente a este encabezado">¶</a></h2>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/smart-greenhouse.png"><img alt="../_images/smart-greenhouse.png" src="../_images/smart-greenhouse.png" style="width: 400px;" /></a>
</figure>
<p>You can program and run Picobricks modules without any wiring. If you are going to use the modules by separating them from the board, then you should make the module connections with the Grove cables provided.</p>
</section>
<section id="micropython-code-of-the-project">
<h2>MicroPython Code of the Project<a class="headerlink" href="#micropython-code-of-the-project" title="Enlace permanente a este encabezado">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">utime</span>
<span class="kn">import</span> <span class="nn">uos</span>
<span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span><span class="p">,</span> <span class="n">ADC</span>
<span class="kn">from</span> <span class="nn">picobricks</span> <span class="kn">import</span> <span class="n">DHT11</span>
<span class="kn">from</span> <span class="nn">utime</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">dht_sensor</span> <span class="o">=</span> <span class="n">DHT11</span><span class="p">(</span><span class="n">Pin</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
<span class="n">smo_sensor</span><span class="o">=</span><span class="n">ADC</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
<span class="n">m1</span><span class="o">.</span><span class="n">low</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Machine: </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">uos</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MicroPython: </span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">uos</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>

<span class="n">uart0</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">UART</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">uart0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">Connect_WiFi</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">uart</span><span class="o">=</span><span class="n">uart0</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CMD: &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">)</span>
<span class="n">uart</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">7.0</span><span class="p">)</span>
<span class="n">Wait_ESP_Rsp</span><span class="p">(</span><span class="n">uart</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">Rx_ESP_Data</span><span class="p">():</span>
<span class="n">recv</span><span class="o">=</span><span class="nb">bytes</span><span class="p">()</span>
<span class="k">while</span> <span class="n">uart0</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">recv</span><span class="o">+=</span><span class="n">uart0</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">res</span><span class="o">=</span><span class="n">recv</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">Send_AT_Cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">uart</span><span class="o">=</span><span class="n">uart0</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CMD: &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">)</span>
<span class="n">uart</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="n">Wait_ESP_Rsp</span><span class="p">(</span><span class="n">uart</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">Wait_ESP_Rsp</span><span class="p">(</span><span class="n">uart</span><span class="o">=</span><span class="n">uart0</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
<span class="n">prvMills</span> <span class="o">=</span> <span class="n">utime</span><span class="o">.</span><span class="n">ticks_ms</span><span class="p">()</span>
<span class="n">resp</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">utime</span><span class="o">.</span><span class="n">ticks_ms</span><span class="p">()</span><span class="o">-</span><span class="n">prvMills</span><span class="p">)</span><span class="o">&lt;</span><span class="n">timeout</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">uart</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">resp</span><span class="p">,</span> <span class="n">uart</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resp:&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>          <span class="c1">#Test AT startup</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+GMR</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1">#Check version information</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CIPSERVER=0</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+RST</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1">#Check version information</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+RESTORE</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1">#Restore Factory Default Settings</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CWMODE?</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1">#Query the WiFi mode</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CWMODE=1</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1">#Set the WiFi mode = Station mode</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CWMODE?</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1">#Query the WiFi mode again</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CWJAP=&quot;ID&quot;,&quot;Password&quot;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span> <span class="c1">#Connect to AP</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CIFSR</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>    <span class="c1">#Obtain the Local IP Address</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CIPMUX=1</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CIPSERVER=1,80</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>    <span class="c1">#Obtain the Local IP Address</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="n">res</span> <span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">res</span><span class="o">=</span><span class="n">Rx_ESP_Data</span><span class="p">()</span>
<span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;+IPD&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span> <span class="c1"># if the buffer contains IPD(a connection), then respond with HTML handshake</span>
    <span class="n">id_index</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;+IPD&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;/WATERING&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Irrigation Start&#39;</span><span class="p">)</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">high</span><span class="p">()</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">low</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Irrigation Finished&#39;</span><span class="p">)</span>
        <span class="n">connection_id</span> <span class="o">=</span>  <span class="n">res</span><span class="p">[</span><span class="n">id_index</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connectionId:&quot;</span> <span class="o">+</span> <span class="n">connection_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;! Incoming connection - sending webpage&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;AT+CIPSEND=&#39;</span><span class="o">+</span><span class="n">connection_id</span><span class="o">+</span><span class="s1">&#39;,200&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;HTTP/1.1 200 OK&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/html&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Connection: close&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;!DOCTYPE HTML&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;body&gt;&lt;center&gt;&lt;H1&gt;CONNECTED...&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;body&gt;&lt;center&gt;&lt;H1&gt;Irrigation Complete.&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;/SERA&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="c1">#sleep(1) # It was used for DHT11 to measure.</span>
        <span class="n">dht_sensor</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span> <span class="c1"># Use the sleep() command before this line.</span>
        <span class="n">temp</span><span class="o">=</span><span class="n">dht_sensor</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">hum</span><span class="o">=</span><span class="n">dht_sensor</span><span class="o">.</span><span class="n">humidity</span>
        <span class="n">smo</span><span class="o">=</span><span class="nb">round</span><span class="p">((</span><span class="n">smo_sensor</span><span class="o">.</span><span class="n">read_u16</span><span class="p">()</span><span class="o">/</span><span class="mi">65535</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">sendStr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">TEMP</span><span class="se">\&quot;</span><span class="s2">:</span><span class="si">{}</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">Humidity</span><span class="se">\&quot;</span><span class="s2">:</span><span class="si">{}</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">S.Moisture</span><span class="se">\&quot;</span><span class="s2">:</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">hum</span><span class="p">,</span><span class="n">smo</span><span class="p">)</span>
        <span class="n">sendText</span><span class="o">=</span><span class="s2">&quot;{&quot;</span><span class="o">+</span><span class="n">sendStr</span><span class="o">+</span><span class="s2">&quot;}&quot;</span>
        <span class="n">strLen</span><span class="o">=</span><span class="mi">46</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">sendText</span><span class="p">)</span>
        <span class="n">connection_id</span> <span class="o">=</span>  <span class="n">res</span><span class="p">[</span><span class="n">id_index</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connectionId:&quot;</span> <span class="o">+</span> <span class="n">connection_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;! Incoming connection - sending webpage&#39;</span><span class="p">)</span>
        <span class="n">atCmd</span><span class="o">=</span><span class="s2">&quot;AT+CIPSEND=&quot;</span><span class="o">+</span><span class="n">connection_id</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">strLen</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">atCmd</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;HTTP/1.1 200 OK&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/html&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sendText</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resp:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">connection_id</span> <span class="o">=</span>  <span class="n">res</span><span class="p">[</span><span class="n">id_index</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;connectionId:&quot;</span> <span class="o">+</span> <span class="n">connection_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;! Incoming connection - sending webpage&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;AT+CIPSEND=&#39;</span><span class="o">+</span><span class="n">connection_id</span><span class="o">+</span><span class="s1">&#39;,200&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;HTTP/1.1 200 OK&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/html&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Connection: close&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;!DOCTYPE HTML&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;body&gt;&lt;center&gt;&lt;H1&gt;CONNECTED.&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;center&gt;&lt;h4&gt;INFO:Get Sensor Data&lt;/br&gt;WATERING:Run Water Pump&lt;/h4&gt;&lt;/center&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">uart0</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span>
    <span class="n">Send_AT_Cmd</span><span class="p">(</span><span class="s1">&#39;AT+CIPCLOSE=&#39;</span><span class="o">+</span> <span class="n">connection_id</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># once file sent, close connection</span>
    <span class="n">utime</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">recv_buf</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1">#reset buffer</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Waiting For connection...&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>If you rename your code file to main.py, your code will run after every boot.</p>
</div>
</section>
<section id="arduino-c-code-of-the-project">
<h2>Arduino C Code of the Project<a class="headerlink" href="#arduino-c-code-of-the-project" title="Enlace permanente a este encabezado">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;DHT.h&gt;</span>
<span class="c1">#define RX 0</span>
<span class="c1">#define TX 1</span>

<span class="c1">#define LIMIT_TEMPERATURE     30</span>
<span class="c1">#define DHTPIN                11</span>
<span class="c1">#define DHTTYPE               DHT11</span>
<span class="c1">#define smo_sensor            27</span>
<span class="c1">#define motor                 22</span>
<span class="c1">#define DEBUG true</span>

<span class="n">DHT</span> <span class="n">dht</span><span class="p">(</span><span class="n">DHTPIN</span><span class="p">,</span> <span class="n">DHTTYPE</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">connectionId</span><span class="p">;</span>

<span class="n">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="n">Serial1</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="n">dht</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">smo_sensor</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
<span class="n">pinMode</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>

<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+RST</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">reset</span> <span class="n">module</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+GMR</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CIPSERVER=0</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+RST</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+RESTORE</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CWMODE?</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CWMODE=1</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CWMODE?</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">as</span> <span class="n">access</span> <span class="n">point</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CWJAP=</span><span class="se">\&quot;</span><span class="s2">WIFI_ID</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">WIFI_PASSWORD</span><span class="se">\&quot;\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">ADD</span> <span class="n">YOUR</span> <span class="n">OWN</span> <span class="n">WIFI</span> <span class="n">ID</span> <span class="n">AND</span> <span class="n">PASSWORD</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CIFSR</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">get</span> <span class="n">ip</span> <span class="n">address</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CIPMUX=1</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">configure</span> <span class="k">for</span> <span class="n">multiple</span> <span class="n">connections</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">sendData</span><span class="p">(</span><span class="s2">&quot;AT+CIPSERVER=1,80</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span> <span class="o">//</span> <span class="n">turn</span> <span class="n">on</span> <span class="n">server</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">80</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span>

<span class="n">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">Serial1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;+IPD,&quot;</span><span class="p">))</span> <span class="p">{</span>
<span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="n">connectionId</span> <span class="o">=</span> <span class="n">Serial1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">-</span> <span class="mi">48</span><span class="p">;</span>
<span class="n">String</span> <span class="n">serialIncoming</span> <span class="o">=</span> <span class="n">Serial1</span><span class="o">.</span><span class="n">readStringUntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">);</span>
<span class="n">Serial</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;SERIAL_INCOMING:&quot;</span><span class="p">);</span>
<span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">serialIncoming</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">serialIncoming</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;/WATERING&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Irrigation Start&quot;</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="o">//</span> <span class="mi">10</span> <span class="n">sec</span><span class="o">.</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Irrigation Finished&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;! Incoming connection - sending WATERING webpage&quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;body&gt;&lt;center&gt;&lt;H1&gt;Irrigation Complete.&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>
  <span class="n">espsend</span><span class="p">(</span><span class="n">html</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">serialIncoming</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s2">&quot;/SERA&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>

  <span class="nb">float</span> <span class="n">smo</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">smo_sensor</span><span class="p">);</span>
  <span class="nb">float</span> <span class="n">smopercent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">460</span><span class="o">-</span><span class="n">smo</span><span class="p">)</span><span class="o">*</span><span class="mf">100.0</span><span class="o">/</span><span class="mf">115.0</span> <span class="p">;</span> <span class="o">//</span><span class="nb">min</span> <span class="n">ve</span> <span class="nb">max</span> <span class="n">değerleri</span> <span class="n">değişken</span><span class="o">.</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;SMO: %&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">smo</span><span class="p">);</span>

  <span class="nb">float</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">dht</span><span class="o">.</span><span class="n">readTemperature</span><span class="p">();</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Temp: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>

  <span class="nb">float</span> <span class="n">humidity</span> <span class="o">=</span> <span class="n">dht</span><span class="o">.</span><span class="n">readHumidity</span><span class="p">();</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Hum: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">humidity</span><span class="p">);</span>

  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;! Incoming connection - sending SERA webpage&quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;body&gt;&lt;center&gt;&lt;H1&gt;TEMPERATURE&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;center&gt;&lt;H2&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">temperature</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot; C&lt;br/&gt;&lt;/H2&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>

  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;body&gt;&lt;center&gt;&lt;H1&gt;HUMIDITY&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;center&gt;&lt;H2&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">humidity</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;%&lt;br/&gt;&lt;/H2&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>

  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;body&gt;&lt;center&gt;&lt;H1&gt;SMO&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;center&gt;&lt;H2&gt;&quot;</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">smopercent</span><span class="p">;</span>
  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;%&lt;br/&gt;&lt;/H2&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>

  <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>
  <span class="n">espsend</span><span class="p">(</span><span class="n">html</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;! Incoming connection - sending MAIN webpage&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;html&gt;&quot;</span><span class="p">;</span>
<span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;body&gt;&lt;center&gt;&lt;H1&gt;CONNECTED.&lt;br/&gt;&lt;/H1&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
<span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;center&gt;&lt;a href=&#39;/SERA&#39;&gt;&lt;h4&gt;INFO:Get Sensor Data&lt;/a&gt;&lt;/br&gt;&lt;a href=&#39;/WATERING&#39;&gt;WATERING:Run Water Pump&lt;/a&gt;&lt;/h4&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
<span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">;</span>
<span class="n">espsend</span><span class="p">(</span><span class="n">html</span><span class="p">);</span>
<span class="n">String</span> <span class="n">closeCommand</span> <span class="o">=</span> <span class="s2">&quot;AT+CIPCLOSE=&quot;</span><span class="p">;</span>  <span class="o">////////////////</span><span class="n">close</span> <span class="n">the</span> <span class="n">socket</span> <span class="n">connection</span><span class="o">////</span><span class="n">esp</span> <span class="n">command</span>
<span class="n">closeCommand</span> <span class="o">+=</span> <span class="n">connectionId</span><span class="p">;</span> <span class="o">//</span> <span class="n">append</span> <span class="n">connection</span> <span class="nb">id</span>
<span class="n">closeCommand</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="n">sendData</span><span class="p">(</span><span class="n">closeCommand</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span>

    <span class="p">}</span>

    <span class="p">}</span>
    <span class="o">//////////////////////////////</span><span class="n">sends</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">ESP</span> <span class="n">to</span> <span class="n">webpage</span><span class="o">///////////////////////////</span>

<span class="n">void</span> <span class="n">espsend</span><span class="p">(</span><span class="n">String</span> <span class="n">d</span><span class="p">)</span>
    <span class="p">{</span>
<span class="n">String</span> <span class="n">cipSend</span> <span class="o">=</span> <span class="s2">&quot; AT+CIPSEND=&quot;</span><span class="p">;</span>
<span class="n">cipSend</span> <span class="o">+=</span> <span class="n">connectionId</span><span class="p">;</span>
<span class="n">cipSend</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span><span class="p">;</span>
<span class="n">cipSend</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">length</span><span class="p">();</span>
<span class="n">cipSend</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="n">sendData</span><span class="p">(</span><span class="n">cipSend</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span>
<span class="n">sendData</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DEBUG</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">//////////////</span><span class="n">gets</span> <span class="n">the</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">esp</span> <span class="ow">and</span> <span class="n">displays</span> <span class="ow">in</span> <span class="n">serial</span> <span class="n">monitor</span><span class="o">///////////////////////</span>

<span class="n">String</span> <span class="n">sendData</span><span class="p">(</span><span class="n">String</span> <span class="n">command</span><span class="p">,</span> <span class="n">const</span> <span class="nb">int</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">boolean</span> <span class="n">debug</span><span class="p">)</span>
    <span class="p">{</span>
<span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="n">Serial1</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="n">long</span> <span class="nb">int</span> <span class="n">time</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="n">timeout</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">millis</span><span class="p">())</span>
    <span class="p">{</span>
<span class="k">while</span> <span class="p">(</span><span class="n">Serial1</span><span class="o">.</span><span class="n">available</span><span class="p">())</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Serial1</span><span class="o">.</span><span class="n">read</span><span class="p">();</span> <span class="o">//</span> <span class="n">read</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">character</span><span class="o">.</span>
  <span class="n">response</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span>
<span class="p">{</span>
<span class="n">Serial</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">response</span><span class="p">);</span> <span class="o">//</span><span class="n">displays</span> <span class="n">the</span> <span class="n">esp</span> <span class="n">response</span> <span class="n">messages</span> <span class="ow">in</span> <span class="n">arduino</span> <span class="n">Serial</span> <span class="n">monitor</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">response</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="coding-the-project-with-microblocks">
<h2>Coding the Project with MicroBlocks<a class="headerlink" href="#coding-the-project-with-microblocks" title="Enlace permanente a este encabezado">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><img alt="smart-greenhouse1" src="../_images/smart-greenhouse1.png" /></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>To code with MicroBlocks, simply drag and drop the image above to the MicroBlocks Run tab.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo_picobricks2.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Tabla de contenido</a></h3>
    <ul>
<li><a class="reference internal" href="#">Smart Greenhouse</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#project-details-and-algorithm">Project Details and Algorithm</a></li>
<li><a class="reference internal" href="#wiring-diagram">Wiring Diagram</a></li>
<li><a class="reference internal" href="#micropython-code-of-the-project">MicroPython Code of the Project</a></li>
<li><a class="reference internal" href="#arduino-c-code-of-the-project">Arduino C Code of the Project</a></li>
<li><a class="reference internal" href="#coding-the-project-with-microblocks">Coding the Project with MicroBlocks</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Tema anterior</h4>
    <p class="topless"><a href="maze%20solver%20robot.html"
                          title="capítulo anterior">Maze Solver Robot</a></p>
  </div>
  <div>
    <h4>Próximo tema</h4>
    <p class="topless"><a href="../education/education.html"
                          title="próximo capítulo">Picobricks Education</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/projects/smart greenhouse.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../education/education.html" title="Picobricks Education"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="maze%20solver%20robot.html" title="Maze Solver Robot"
             >anterior</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">documentación de PicoBricks - 5.3.0-dev</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="projects.html" >Projects</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Smart Greenhouse</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Derechos de autor 2022, Robotistan.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>